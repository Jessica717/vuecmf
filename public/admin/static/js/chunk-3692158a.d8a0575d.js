(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3692158a"],{6690:function(t,e,a){"use strict";a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s}),a.d(e,"c",function(){return l});var o=576,r=768;function i(){var t=document.body.getBoundingClientRect();return t.width<=o}function s(){var t=document.body.getBoundingClientRect();return t.width>o&&t.width<=r}function l(t,e,a){var o=220;1==e&&(o=70);var r=document.documentElement.clientWidth-o,i=document.documentElement.clientHeight-240;1==a&&(r-=160),t.height=i,t.width=r}},"66aa":function(t,e,a){},"681d":function(t,e,a){},"750a":function(t,e,a){"use strict";var o=a("66aa"),r=a.n(o);r.a},"96df":function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{overflow:"auto",flex:"auto"}},[a("Row",{staticClass:"tool-bar"},[a("Col",{attrs:{xs:24,sm:12,md:12,lg:12}},[a("Button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("添加主"+t._s(t.label))]),a("i-switch",{staticStyle:{"margin-left":"10px"},attrs:{size:"large"},model:{value:t.isFoldStatus,callback:function(e){t.isFoldStatus=e},expression:"isFoldStatus"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("折叠")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("展开")])])],1),a("Col",{attrs:{xs:24,sm:12,md:12,lg:12}},[a("Input",{attrs:{placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1)],1),a("tree-table",{ref:"table",attrs:{data:t.treeData,columns:t.columns,stripe:!0,"tree-type":!0,"is-fold":t.isFoldStatus,"expand-key":t.expandKey,"expand-type":!1,selectable:!1},scopedSlots:t._u([{key:"status",fn:function(e){var o=e.row;e.index;return[a("i-switch",{attrs:{size:"large","true-value":1,"false-value":2},on:{"on-change":function(e){return t.switchStatus(o.id,o.status)}},model:{value:o.status,callback:function(e){t.$set(o,"status",e)},expression:"row.status"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("开启")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("关闭")])])]}},{key:"action",fn:function(e){var o=e.row;e.index;return[a("Button",{attrs:{type:"info",icon:"ios-add-circle-outline",size:"small"},on:{click:function(e){return t.addChild(o)}}},[t._v("添加下级")]),a("Button",{attrs:{type:"success",icon:"ios-create-outline",size:"small"},on:{click:function(e){return t.editNode(o)}}},[t._v("编辑")]),a("Button",{attrs:{type:"error",icon:"ios-remove-circle-outline",size:"small"},on:{click:function(e){return t.delForm(o)}}},[t._v("删除")]),t._t("rowAction",null,{row:o})]}}],null,!0)}),a("tree-form",{ref:"addDataDlg",attrs:{"data-form-title":t.formDlgTitle,"model-width":t.modelWidth,"model-height":t.modelHeight,"form-label-width":t.formLabelWidth,"data-form":t.dataForm,"rule-validate":t.ruleValidate,"fields-data":t.fields_data,"ref-name":"addDataForm"},on:{"on-save-data-form":t.saveAddDataForm}}),a("tree-form",{ref:"editDataDlg",attrs:{"data-form-title":t.formDlgTitle,"model-width":t.modelWidth,"model-height":t.modelHeight,"form-label-width":t.formLabelWidth,"data-form":t.editDataForm,"rule-validate":t.ruleValidate,"fields-data":t.fields_data,"ref-name":"editDataForm"},on:{"on-save-data-form":t.saveEditDataForm}})],1)},r=[],i=(a("7f7f"),a("ac6a"),a("a026")),s=a("6690"),l=a("ee1a"),n=a.n(l),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{attrs:{title:t.dataFormTitle,width:t.modelWidth,"class-name":"vertical-center-modal",styles:{top:"20px",height:t.modelHeight,zIndex:100},draggable:""},model:{value:t.dataFormShow,callback:function(e){t.dataFormShow=e},expression:"dataFormShow"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("h3",[t._v(t._s(t.dataFormTitle))])]),a("Form",{ref:t.refName,attrs:{"label-width":t.formLabelWidth,model:t.dataForm,rules:t.ruleValidate}},[t._l(t.fieldsData,function(e,o){return[1==e.data_form?["hidden"==e.data_type?[a("input",{directives:[{name:"model",rawName:"v-model",value:t.dataForm[e.prop],expression:"dataForm[item.prop]"}],key:t.dataForm[e.prop],attrs:{type:"hidden"},domProps:{value:t.dataForm[e.prop]},on:{input:function(a){a.target.composing||t.$set(t.dataForm,e.prop,a.target.value)}}})]:[a("Row",{key:o},[a("FormItem",{attrs:{label:e.title,prop:e.prop}},["select"==e.data_type?a("Select",{staticStyle:{width:"200px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}},[t._l(e.options,function(e,o){return["object"==typeof e?a("Option",{key:o,attrs:{value:e.id}},[t._v(t._s(e.label))]):a("Option",{key:o,attrs:{value:parseInt(o)}},[t._v(t._s(e))])]})],2):"date"==e.data_type?a("DatePicker",{attrs:{type:"date",format:"yyyy-MM-dd",placeholder:""},on:{"on-change":function(a){t.changeDatetime(a,e.prop)},"on-open-change":function(e){t.dataFormShow=!0}},model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}}):"datetime"==e.data_type?a("DatePicker",{attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm:ss",placeholder:""},on:{"on-change":function(a){t.changeDatetime(a,e.prop)},"on-open-change":function(e){t.dataFormShow=!0}},model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}}):"radio"==e.data_type?a("RadioGroup",{model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}},[t._l(e.options,function(e,o){return[/^\d+$/.test(o)?a("Radio",{key:parseInt(o),attrs:{label:parseInt(o)}},[a("span",[t._v(t._s(e))])]):/^\d+\.+\d+$/.test(o)?a("Radio",{key:parseInt(o),attrs:{label:parseFloat(o)}},[a("span",[t._v(t._s(e))])]):a("Radio",{key:parseInt(o),attrs:{label:o}},[a("span",[t._v(t._s(e))])])]})],2):"textarea"==e.data_type?a("Input",{attrs:{type:"textarea",rows:4,placeholder:"请输入"+e.title},model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}}):a("Input",{attrs:{placeholder:"请输入"+e.title},model:{value:t.dataForm[e.prop],callback:function(a){t.$set(t.dataForm,e.prop,a)},expression:"dataForm[item.prop]"}})],1)],1)]]:t._e()]})],2),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:t.resetDataForm}},[t._v("重置")]),a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.saveDataForm()}}},[t._v("保存")])],1)],1)],1)},u=[],m=(a("a481"),{name:"tree-form",props:["dataFormTitle","modelWidth","modelHeight","formLabelWidth","dataForm","ruleValidate","fieldsData","refName"],data:function(){return{dataFormShow:!1}},updated:function(){var t=this;t.fieldsData.forEach(function(e){"date"!=e.data_type&&"datetime"!=e.data_type||(t.dataForm[e.prop]=t.getFormatDate(t.dataForm[e.prop]))})},mounted:function(){},methods:{getFormatDate:function(t){var e=new Date(t).toJSON(),a=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return a},resetDataForm:function(){this.$refs[this.refName].resetFields()},saveDataForm:function(){this.$emit("on-save-data-form",this.dataForm)},changeDatetime:function(t,e){this.dataForm[e]=t,this.dataFormShow=!0}}}),c=m,p=(a("750a"),a("0c7c")),f=Object(p["a"])(c,d,u,!1,null,null,null),h=f.exports;i["default"].use(n.a);var F={name:"tree_list",components:{"tree-form":h},props:["label","isFold","modelWidth","modelHeight","operateWidth","filterForm","expandKey"],data:function(){return{fields_data:[],columns:[],dataForm:{},editDataForm:{},formLabelWidth:80,formDlgTitle:"",ruleValidate:{},treeData:[],filterText:"",isFoldStatus:!0}},beforeMount:function(){window.addEventListener("resize",this.resize)},mounted:function(){var t=this;t.loadTableField(),t.refresh(),t.resize(),t.isFoldStatus=t.isFold},watch:{filterText:function(t){this.filterNode(t),this.isFoldStatus=!0}},methods:{loadTableField:function(){this.pullData(this.updateTableField,"getField")},updateTableField:function(t){var e=this;t.fields.forEach(function(t){if(1==t["data_form"]){var a="";void 0!=t["default"]&&(a=t["default"]),"string"==typeof a&&(a=a.trim()),e.$set(e.dataForm,t["prop"],a),void 0!=t["validate"]&&void 0!=t["validate"].length&&e.$set(e.ruleValidate,t["prop"],t["validate"])}var o={title:t["label"],key:t["prop"],prop:t["prop"],data_type:t["data_type"],width:t["width"],minWidth:t["width"],tips:t["tooltip"],options:t["options"],data_form:t["data_form"],field_id:t["field_id"]};"status"==t["prop"]&&(o["type"]="template",o["template"]="status"),t["model_id"]==t["relation_model_id"]&&"select"==t["data_type"]&&e.$api.request(e.$route.meta.model,e.$route.meta.permission.tree,"get").then(function(t){0==t.code?(o["options"]=t.data,o["options"].unshift({id:0,label:"根"+e.label})):e.$Message.error(t.msg)}),e.fields_data.push(o),1==t["show"]&&e.columns.push(o)}),e.columns.push({title:"操作",key:"id",type:"template",template:"action",width:e.operateWidth,data_form:!1})},pullData:function(t,e,a,o){var r=this;"undefined"!=typeof e&&"getField"==e?r.$api.request(r.$route.meta.model,r.$route.meta.permission.list,"post",{action:"getField"}).then(function(e){0==e.code?t(e.data):r.$Message.error(e.msg)}):this.$api.request(r.$route.meta.model,r.$route.meta.permission.list,"post",a).then(function(t){0==t.code?(null!=t.data?r.treeData=JSON.parse(JSON.stringify(t.data)):r.treeData=[],"function"==typeof o&&o(r.treeData)):r.$Message.error(t.msg)})},refresh:function(t){this.pullData(null,null,this.filterForm,t)},resize:function(){s["a"]()?this.formLabelWidth=120:s["b"]()?this.formLabelWidth=100:this.formLabelWidth=80},filterNode:function(t){this.filterForm["keyword"]=t,this.pullData(null,null,this.filterForm)},switchStatus:function(t,e){var a=this;a.$api.request(a.$route.meta.model,a.$route.meta.permission.status,"post",{id:t,status:e}).then(function(t){0!=t.code&&a.$Message.error(t.msg)})},delForm:function(t){var e=this;if(e.isFoldStatus=!1,void 0!=t.children&&t.children.length>0)return e.$Message.error("不能删除含有子"+this.label+"的"+this.label),!1;e.$api.request(e.$route.meta.model,e.$route.meta.permission.del,"post",t).then(function(t){0==t.code?(e.refresh(),e.$Message.success(t.msg)):e.$Message.error(t.msg)})},saveAddDataForm:function(t){this.save(t),this.isFoldStatus=!1},saveEditDataForm:function(t){this.save(t),this.isFoldStatus=!1},add:function(){this.formDlgTitle="添加"+this.label,this.$refs["addDataDlg"].dataFormShow=!0,this.isFoldStatus=!1},addChild:function(t){this.$emit("on-add-child",t,this.dataForm),this.formDlgTitle="添加（"+t.name+"）子"+this.label,this.$refs["addDataDlg"].dataFormShow=!0},editNode:function(t){this.formDlgTitle="编辑"+this.label,this.editDataForm=t,this.$refs["editDataDlg"].dataFormShow=!0,this.isFoldStatus=!1},save:function(t){var e=this;e.$api.request(e.$route.meta.model,e.$route.meta.permission.save,"post",t).then(function(t){0==t.code?(e.refresh(),e.$Message.success(t.msg)):e.$Message.error(t.msg)})}}},v=F,g=(a("eb81"),Object(p["a"])(v,o,r,!1,null,"35214269",null));e["a"]=g.exports},eb81:function(t,e,a){"use strict";var o=a("681d"),r=a.n(o);r.a},f136:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("tree-list",{ref:"menuTree",attrs:{label:"菜单","is-fold":!0,"model-width":"80%","model-height":"90%","operate-width":200,"filter-form":t.filterForm,"expand-key":"title"},on:{"on-add-child":t.addChild}})],1)},r=[],i=(a("7f7f"),a("96df")),s={name:"menu_tree",components:{"tree-list":i["a"]},data:function(){return{filterForm:{}}},mounted:function(){var t=this;t.title=t.$route.name,console.log(t.$route.meta.permission)},methods:{addChild:function(t,e){e.pid=t.id}}},l=s,n=a("0c7c"),d=Object(n["a"])(l,o,r,!1,null,"59953e2d",null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-3692158a.d8a0575d.js.map